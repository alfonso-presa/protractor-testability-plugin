/*! protractor-testability-plugin - v1.1.0
 *  Release on: 2016-09-25
 *  Copyright (c) 2016 Alfonso Presa
 *  Licensed MIT */
!function(a,b){"function"==typeof define&&define.amd?define([],function(){return b()}):"object"==typeof exports?module.exports=b():b()}(this,function(){"use strict";var a=require("fs");return{name:"protractor-testability-plugin",onPageLoad:function(){var b=a.readFileSync(require.resolve("testability.js")).toString();browser.executeScript("if(!window.testability) {"+b+"}"),browser.executeScript(function(){function a(a,b,c){var e=window[a],f=window[b],g={};window[a]=function(){var a,b=arguments[0],f=arguments[1];return arguments[0]=function(){g[a]=void 0,(!c||f<5e3)&&d(window.testability.wait.oneLess()),b.apply(window,arguments)},a=e.apply(window,arguments),(!c||f<5e3)&&(window.testability.wait.oneMore(),g[a]=!0),a},window[b]=function(){return g[arguments[0]]&&(d(window.testability.wait.oneLess()),g[arguments[0]]=void 0),f.apply(window,arguments)}}function c(a){var b=window[a];window[a]=function(){var a;return a=b.apply(window,arguments),a.then(function(a){return d(window.testability.wait.oneLess()),a}),window.testability.wait.oneMore(),a}}var d=window.setTimeout;window.angular||(window.angular={resumeBootstrap:function(){},module:function(){return{config:function(){return this}}},getTestability:function(){var a=function(a){a()},b=window.customAngularTestability;return b?("undefined"==typeof b.whenStable&&(b.whenStable=a),b):{whenStable:a}}},window.getAllAngularTestabilities=function(){return[window.angular.getTestability()]}),a("setTimeout","clearTimeout",!0),a("setInterval","clearInterval",!0),a("setImmediate","clearImmediate",!1);var e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(a,c,f,g,h){window.testability&&(b.wait.oneMore(),this.addEventListener("readystatechange",function(){4===this.readyState&&d(b.wait.oneLess())},!1)),e.call(this,a,c,f,g,h)},c("fetch")})},waitForPromise:function(){return browser.executeAsyncScript("return window.testability && window.testability.when.ready.apply(null,arguments)").then(function(a){if(a)throw"Error while waiting to sync with the page: "+JSON.stringify(a)})}}});