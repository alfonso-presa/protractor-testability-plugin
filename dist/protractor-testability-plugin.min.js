/*! protractor-testability-plugin - v1.0.4
 *  Release on: 2016-09-22
 *  Copyright (c) 2016 Alfonso Presa
 *  Licensed MIT */
!function(a,b){"function"==typeof define&&define.amd?define([],function(){return b()}):"object"==typeof exports?module.exports=b():b()}(this,function(){"use strict";var a=require("fs");return{name:"protractor-testability-plugin",onPageLoad:function(){var b=a.readFileSync(require.resolve("testability.js")).toString();browser.executeScript("if(!window.testability) {"+b+"}"),browser.executeScript(function(){function a(a,b,c){var d=window[a],e=window[b],f={};window[a]=function(){var a,b=arguments[0],e=arguments[1];return arguments[0]=function(){f[a]=void 0,(!c||5e3>e)&&window.testability.wait.oneLess(),b.apply(window,arguments)},a=d.apply(window,arguments),(!c||5e3>e)&&(window.testability.wait.oneMore(),f[a]=!0),a},window[b]=function(){return f[arguments[0]]&&(window.testability.wait.oneLess(),f[arguments[0]]=void 0),e.apply(window,arguments)}}function c(a){var b=window[a];window[a]=function(){var a;return a=b.apply(window,arguments),a.then(function(a){return window.testability.wait.oneLess(),a}),window.testability.wait.oneMore(),a}}window.angular||(window.angular={resumeBootstrap:function(){},module:function(){return{config:function(){return this}}},getTestability:function(){return{whenStable:function(a){a()}}}},window.getAllAngularTestabilities=function(){return[window.angular.getTestability()]}),a("setTimeout","clearTimeout",!0),a("setInterval","clearInterval",!0),a("setImmediate","clearImmediate",!1);var d=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(a,c,e,f,g){window.testability&&(b.wait.oneMore(),this.addEventListener("readystatechange",function(){4===this.readyState&&b.wait.oneLess()},!1)),d.call(this,a,c,e,f,g)},c("fetch")})},waitForPromise:function(){return browser.executeAsyncScript("return window.testability && window.testability.when.ready.apply(null,arguments)").then(function(a){if(a)throw"Error while waiting to sync with the page: "+JSON.stringify(a)})}}});