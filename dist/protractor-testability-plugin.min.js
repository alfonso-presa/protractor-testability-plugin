/*! protractor-testability-plugin - v1.1.0
 *  Release on: 2016-09-25
 *  Copyright (c) 2016 Alfonso Presa
 *  Licensed MIT */
!function(a,b){"function"==typeof define&&define.amd?define([],function(){return b()}):"object"==typeof exports?module.exports=b():b()}(this,function(){"use strict";var fs=require("fs");return{name:"protractor-testability-plugin",onPageLoad:function(){var testability=fs.readFileSync(require.resolve("testability.js")).toString();browser.executeScript("if(!window.testability) {"+testability+"}"),browser.executeScript(function(customTestability){function patchFunction(a,b,c){var d=window[a],e=window[b],f={};window[a]=function(){var a,b=arguments[0],e=arguments[1];return arguments[0]=function(){f[a]=void 0,(!c||5e3>e)&&setTimeout(window.testability.wait.oneLess()),b.apply(window,arguments)},a=d.apply(window,arguments),(!c||5e3>e)&&(window.testability.wait.oneMore(),f[a]=!0),a},window[b]=function(){return f[arguments[0]]&&(setTimeout(window.testability.wait.oneLess()),f[arguments[0]]=void 0),e.apply(window,arguments)}}function patchPromiseFunction(a){var b=window[a];window[a]=function(){var a;return a=b.apply(window,arguments),a.then(function(a){return setTimeout(window.testability.wait.oneLess()),a}),window.testability.wait.oneMore(),a}}customTestability=customTestability&&JSON.parse(customTestability,function reviver(key,item){return"string"==typeof item&&0===item.indexOf("var temp=")?eval(item):item});var setTimeout=window.setTimeout;window.angular||(window.angular={resumeBootstrap:function(){},module:function(){return{config:function(){return this}}},getTestability:function(){var a=customTestability||{};return a.whenStable=a.whenStable||function(a){a()},a}},window.getAllAngularTestabilities=function(){return[window.angular.getTestability()]}),patchFunction("setTimeout","clearTimeout",!0),patchFunction("setInterval","clearInterval",!0),patchFunction("setImmediate","clearImmediate",!1);var oldOpen=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(a,b,c,d,e){window.testability&&(testability.wait.oneMore(),this.addEventListener("readystatechange",function(){4===this.readyState&&setTimeout(testability.wait.oneLess())},!1)),oldOpen.call(this,a,b,c,d,e)},patchPromiseFunction("fetch")},JSON.stringify(this.config.customFrameworkTestability,function(a,b){return"function"==typeof b?"var temp="+b.toString()+";temp;":b}))},waitForPromise:function(){return browser.executeAsyncScript("return window.testability && window.testability.when.ready.apply(null,arguments)").then(function(a){if(a)throw"Error while waiting to sync with the page: "+JSON.stringify(a)})}}});